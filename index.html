<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .main, .test-form {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        .test-form {
            display: none;
        }
        .f-btn, .s-btn, .submit-btn {
            padding: 10px 20px;
            margin: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .error {
            color: red;
            display: none;
        }
    </style>
</head>
<body>
    <div class="main">
        <h2>Тест Web App</h2>
        <button class="f-btn">Открыть форму</button>
    </div>
    <div class="test-form">
        <h2>Тестовая форма</h2>
        <input type="text" id="testInput" placeholder="Введите текст">
        <button class="submit-btn">Отправить</button>
        <button class="s-btn">Закрыть</button>
        <div class="error" id="errorMessage"></div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let fBtn = document.getElementsByClassName("f-btn")[0];
        let sBtn = document.getElementsByClassName("s-btn")[0];
        let submitBtn = document.getElementsByClassName("submit-btn")[0];
        let errorMessage = document.getElementById("errorMessage");

        fBtn.addEventListener("click", () => {
            console.log("Кнопка 'Открыть форму' нажата");
            document.getElementsByClassName("main")[0].style.display = "none";
            document.getElementsByClassName("test-form")[0].style.display = "block";
        });

        sBtn.addEventListener("click", () => {
            console.log("Кнопка 'Закрыть' нажата");
            tg.close();
        });

        submitBtn.addEventListener("click", () => {
            console.log("Кнопка 'Отправить' нажата");
            const testData = {
                test_input: document.getElementById("testInput").value.trim() || "тест"
            };
            console.log("Отправляемые данные:", testData);
            try {
                if (!window.Telegram?.WebApp) {
                    console.error("Telegram WebApp не инициализирован");
                    errorMessage.textContent = "Ошибка: Telegram Web App не инициализирован";
                    errorMessage.style.display = "block";
                    return;
                }
                const jsonData = JSON.stringify(testData);
                console.log("JSON для отправки:", jsonData);
                tg.sendData(jsonData);
                console.log("Данные успешно отправлены в Telegram");
                setTimeout(() => {
                    tg.close();
                }, 500);
            } catch (error) {
                console.error("Ошибка отправки данных:", error);
                errorMessage.textContent = "Ошибка отправки данных: " + error.message;
                errorMessage.style.display = "block";
            }
        });

        console.log("Telegram WebApp:", window.Telegram?.WebApp);
        console.log("WebApp ready:", tg.isExpanded, tg.initData);
    </script>
</body>
</html>