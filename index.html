<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Wildberries</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .radio-item:hover {
            background-color: #f1f3f4;
        }

        .radio-item input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .conditional-field {
            margin-top: 15px;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .conditional-field.show {
            opacity: 1;
            max-height: 100px;
        }

        .info-card {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-card h3 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .info-card p {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
        }

        .loading.show {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff30;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .preview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .preview h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .preview-item span:first-child {
            color: #666;
        }

        .preview-item span:last-child {
            color: #333;
            font-weight: 600;
        }

        .error {
            color: #d32f2f;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .error.show {
            display: block;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
                border-radius: 15px;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞</h1>
            <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Wildberries</p>
        </div>

        <form id="parsingForm">
            <div class="form-group">
                <label for="sessionName">üìù –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏:</label>
                <input type="text" id="sessionName" name="sessionName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞—Ä—Å–∏–Ω–≥ –ª–∞–∫–æ–≤ –¥–ª—è –Ω–æ–≥—Ç–µ–π" required>
            </div>

            <div class="form-group">
                <label>üéØ –†–µ–∂–∏–º –ø–∞—Ä—Å–∏–Ω–≥–∞:</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="mode1" name="mode" value="1" checked>
                        <label for="mode1">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="mode2" name="mode" value="2">
                        <label for="mode2">–ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É</label>
                    </div>
                </div>
            </div>

            <div id="searchField" class="conditional-field">
                <div class="form-group">
                    <label for="searchQuery">üîç –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:</label>
                    <input type="text" id="searchQuery" name="searchQuery" placeholder="–ª–∞–∫ –¥–ª—è –Ω–æ–≥—Ç–µ–π">
                </div>
            </div>

            <div id="scrollsField" class="conditional-field show">
                <div class="form-group">
                    <label for="scrolls">üìú –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Ä—É—Ç–æ–∫:</label>
                    <input type="number" id="scrolls" name="scrolls" value="5" min="1" max="50">
                </div>
            </div>

            <div id="pagesField" class="conditional-field">
                <div class="form-group">
                    <label for="pages">üìÑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü:</label>
                    <input type="number" id="pages" name="pages" value="2" min="1" max="20">
                </div>
            </div>

            <div class="form-group">
                <label for="minReviews">‚≠ê –ú–∏–Ω–∏–º—É–º –æ—Ç–∑—ã–≤–æ–≤:</label>
                <input type="number" id="minReviews" name="minReviews" value="100" min="1" max="10000">
            </div>

            <div class="info-card">
                <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p id="modeInfo">–ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã Wildberries —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ–∫—Ä—É—Ç–æ–∫.</p>
            </div>

            <div class="preview">
                <h3>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫</h3>
                <div class="preview-item">
                    <span>–†–µ–∂–∏–º:</span>
                    <span id="previewMode">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</span>
                </div>
                <div class="preview-item" id="previewQueryRow" style="display: none;">
                    <span>–ó–∞–ø—Ä–æ—Å:</span>
                    <span id="previewQuery">-</span>
                </div>
                <div class="preview-item" id="previewScrollsRow">
                    <span>–ü—Ä–æ–∫—Ä—É—Ç–∫–∏:</span>
                    <span id="previewScrolls">5</span>
                </div>
                <div class="preview-item" id="previewPagesRow" style="display: none;">
                    <span>–°—Ç—Ä–∞–Ω–∏—Ü—ã:</span>
                    <span id="previewPages">2</span>
                </div>
                <div class="preview-item">
                    <span>–ú–∏–Ω. –æ—Ç–∑—ã–≤–æ–≤:</span>
                    <span id="previewReviews">100</span>
                </div>
            </div>

            <button type="submit" class="btn" id="submitBtn">
                <span class="loading" id="loading"></span>
                <span id="btnText">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥</span>
            </button>

            <div class="error" id="errorMessage"></div>
        </form>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã
        const form = document.getElementById('parsingForm');
        const mode1 = document.getElementById('mode1');
        const mode2 = document.getElementById('mode2');
        const searchField = document.getElementById('searchField');
        const scrollsField = document.getElementById('scrollsField');
        const pagesField = document.getElementById('pagesField');
        const modeInfo = document.getElementById('modeInfo');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const btnText = document.getElementById('btnText');
        const errorMessage = document.getElementById('errorMessage');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        const previewMode = document.getElementById('previewMode');
        const previewQuery = document.getElementById('previewQuery');
        const previewScrolls = document.getElementById('previewScrolls');
        const previewPages = document.getElementById('previewPages');
        const previewReviews = document.getElementById('previewReviews');
        const previewQueryRow = document.getElementById('previewQueryRow');
        const previewScrollsRow = document.getElementById('previewScrollsRow');
        const previewPagesRow = document.getElementById('previewPagesRow');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
        mode1.addEventListener('change', function() {
            if (this.checked) {
                searchField.classList.remove('show');
                pagesField.classList.remove('show');
                scrollsField.classList.add('show');
                modeInfo.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã Wildberries —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ–∫—Ä—É—Ç–æ–∫.';
                updatePreview();
            }
        });

        mode2.addEventListener('change', function() {
            if (this.checked) {
                searchField.classList.add('show');
                pagesField.classList.add('show');
                scrollsField.classList.remove('show');
                modeInfo.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.';
                updatePreview();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        document.getElementById('sessionName').addEventListener('input', updatePreview);
        document.getElementById('searchQuery').addEventListener('input', updatePreview);
        document.getElementById('scrolls').addEventListener('input', updatePreview);
        document.getElementById('pages').addEventListener('input', updatePreview);
        document.getElementById('minReviews').addEventListener('input', updatePreview);

        function updatePreview() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const sessionName = document.getElementById('sessionName').value;
            const searchQuery = document.getElementById('searchQuery').value;
            const scrolls = document.getElementById('scrolls').value;
            const pages = document.getElementById('pages').value;
            const minReviews = document.getElementById('minReviews').value;

            if (mode === '1') {
                previewMode.textContent = '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞';
                previewQueryRow.style.display = 'none';
                previewScrollsRow.style.display = 'flex';
                previewPagesRow.style.display = 'none';
                previewScrolls.textContent = scrolls;
            } else {
                previewMode.textContent = '–ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É';
                previewQueryRow.style.display = 'flex';
                previewScrollsRow.style.display = 'none';
                previewPagesRow.style.display = 'flex';
                previewQuery.textContent = searchQuery || '-';
                previewPages.textContent = pages;
            }

            previewReviews.textContent = minReviews;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 5000);
        }

        function validateForm() {
            const sessionName = document.getElementById('sessionName').value.trim();
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const searchQuery = document.getElementById('searchQuery').value.trim();
            const scrolls = parseInt(document.getElementById('scrolls').value);
            const pages = parseInt(document.getElementById('pages').value);
            const minReviews = parseInt(document.getElementById('minReviews').value);

            if (!sessionName) {
                showError('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏');
                return false;
            }

            if (mode === '2' && !searchQuery) {
                showError('–î–ª—è —Ä–µ–∂–∏–º–∞ –ø–æ–∏—Å–∫–∞ —É–∫–∞–∂–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å');
                return false;
            }

            if (mode === '1' && (scrolls < 1 || scrolls > 50)) {
                showError('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Ä—É—Ç–æ–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 50');
                return false;
            }

            if (mode === '2' && (pages < 1 || pages > 20)) {
                showError('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 20');
                return false;
            }

            if (minReviews < 1 || minReviews > 10000) {
                showError('–ú–∏–Ω–∏–º—É–º –æ—Ç–∑—ã–≤–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 10000');
                return false;
            }

            return true;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            if (!validateForm()) {
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.classList.add('show');
            btnText.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            submitBtn.disabled = true;

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const formData = {
                session_name: document.getElementById('sessionName').value.trim(),
                mode: parseInt(document.querySelector('input[name="mode"]:checked').value),
                search_query: document.getElementById('searchQuery').value.trim(),
                scrolls: parseInt(document.getElementById('scrolls').value),
                pages: parseInt(document.getElementById('pages').value),
                min_reviews: parseInt(document.getElementById('minReviews').value)
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Telegram WebApp
            try {
                tg.sendData(JSON.stringify(formData));

                // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–æ–∫–∞–∑–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(() => {
                    tg.close();
                }, 500);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');

                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                loading.classList.remove('show');
                btnText.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥';
                submitBtn.disabled = false;
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        updatePreview();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –ø–æ–¥ Telegram
        if (tg.colorScheme === 'dark') {
            document.body.style.background = 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)';
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        tg.MainButton.setText('–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥');
        tg.MainButton.show();

        tg.MainButton.onClick(() => {
            form.dispatchEvent(new Event('submit'));
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        tg.onEvent('backButtonClicked', () => {
            tg.close();
        });

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.form-group, .info-card, .preview').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'all 0.6s ease';
            observer.observe(el);
        });
    </script>
</body>
</html>